import telebot import psycopg2 import time import threading # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞ API_TOKEN = '8062912990:AAGNky8Z2HbMopUy-nWoIhIX-rU6sPPXXzY' bot = telebot.TeleBot(API_TOKEN) # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö DB_HOST = 'localhost' DB_NAME = 'postgres' DB_USER = 'postgres' DB_PASSWORD = '12345' DB_PORT = '5432' # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö try: conn = psycopg2.connect( host=DB_HOST, database=DB_NAME, user=DB_USER, password=DB_PASSWORD, port=DB_PORT ) cursor = conn.cursor() print("–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ.") except Exception as e: print(f"–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö: {e}") exit() # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –¥–ª—è –æ—Ç–∑—ã–≤–æ–≤, –∑–∞–∫–∞–∑–æ–≤ –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ cursor.execute(""" CREATE TABLE IF NOT EXISTS feedback ( id SERIAL PRIMARY KEY, student_name TEXT, feedback_text TEXT, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ) """) cursor.execute(""" CREATE TABLE IF NOT EXISTS orders ( id SERIAL PRIMARY KEY, student_id INTEGER, order_details TEXT, estimated_delivery_time TEXT, status TEXT, price DECIMAL(10, 2), FOREIGN KEY (student_id) REFERENCES students(id) ) """)
cursor.execute(""" CREATE TABLE IF NOT EXISTS admins ( id SERIAL PRIMARY KEY, telegram_id BIGINT UNIQUE ) """) conn.commit() # –°–ª–æ–≤–∞—Ä—å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ –∑–∞–∫–∞–∑–æ–≤ order_statuses = {} cart = {} # –ö–æ–º–∞–Ω–¥–∞ /start @bot.message_handler(commands=['start']) def send_welcome(message): markup = telebot.types.ReplyKeyboardMarkup(resize_keyboard=True) start_button = telebot.types.KeyboardButton("üë§ –í–æ–π—Ç–∏") register_button = telebot.types.KeyboardButton("üìù –ù–∞—á–∞—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é") contacts_button = telebot.types.KeyboardButton("üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã") wifi_button = telebot.types.KeyboardButton("üì∂ Wi-Fi") feedback_button = telebot.types.KeyboardButton("üìù –û –Ω–∞—Å") markup.add(start_button, register_button, contacts_button, wifi_button, feedback_button) bot.send_message(message.chat.id, "üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:", reply_markup=markup) # –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è "üìù –û –Ω–∞—Å" @bot.message_handler(func=lambda message: message.text == "üìù –û –Ω–∞—Å") def show_feedback(message): cursor.execute("SELECT feedback_text FROM feedback") feedbacks = cursor.fetchall() if feedbacks: response = "–û—Ç–∑—ã–≤—ã:\n" for feedback in feedbacks: response += f"- {feedback[0]}\n" bot.send_message(message.chat.id, response) else: bot.send_message(message.chat.id, "–ù–µ—Ç –æ—Ç–∑—ã–≤–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.") # –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è Wi-Fi @bot.message_handler(func=lambda message: message.text == "üì∂ Wi-Fi") def send_wifi_info(message): wifi_info = "Wi-Fi –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: Wi-Fi Guest\n–ü–∞—Ä–æ–ª—å: aitu2022!" bot.send_message(message.chat.id, wifi_info) # –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ —á–∞—Ç–∞ def clear_chat(message): chat_id = message.chat.id try: # –£–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
message_count = 100 # –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ for message_id in range(message.message_id, message.message_id - message_count, -1): try: bot.delete_message(chat_id, message_id) except Exception: # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ pass bot.send_message(chat_id, "‚úÖ –ß–∞—Ç –æ—á–∏—â–µ–Ω (—É–¥–∞–ª–µ–Ω—ã –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è).") except Exception as e: bot.send_message(chat_id, f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ —á–∞—Ç–∞: {e}") # –ö–æ–º–∞–Ω–¥–∞ /help @bot.message_handler(commands=['help']) def send_help(message): help_text = "‚ùì –ü–æ–º–æ—â—å:\n" \ "/start - –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞\n" \ "/clear - –û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç\n" \ "/help - –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ\n" \ "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ—É–Ω–∫—Ü–∏—è–º." bot.send_message(message.chat.id, help_text) # –ö–æ–º–∞–Ω–¥–∞ —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è @bot.message_handler(commands=['reset']) def reset_password(message): bot.send_message(message.chat.id, "–í—ã —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å? –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è.") bot.register_next_step_handler(message, verify_name_for_reset) # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–µ–Ω–∏ –¥–ª—è —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è def verify_name_for_reset(message): name = message.text.strip() if not name: bot.send_message(message.chat.id, "–ò–º—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.") return bot.register_next_step_handler(message, verify_name_for_reset) # –ü—Ä–æ–≤–µ—Ä–∫–∞, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –∏–º—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö try: cursor.execute("SELECT phone FROM students WHERE name = %s", (name,)) user = cursor.fetchone() if user: # –ï—Å–ª–∏ –∏–º—è –Ω–∞–π–¥–µ–Ω–æ, –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è bot.send_message(message.chat.id, "–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.") bot.register_next_step_handler(message, verify_phone_for_reset, name) else:
bot.send_message(message.chat.id, "–¢–∞–∫–æ–µ –∏–º—è –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –≤–≤–µ–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏–º—è.") except Exception as e: bot.send_message(message.chat.id, f"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∏–º–µ–Ω–∏: {e}") # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è def verify_phone_for_reset(message, name): phone = message.text.strip() try: cursor.execute("SELECT phone FROM students WHERE name = %s", (name,)) user = cursor.fetchone() if user and user[0] == phone: # –ï—Å–ª–∏ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ —Å–æ–≤–ø–∞–¥–∞–µ—Ç, –ø—Ä–µ–¥–ª–æ–∂–∏–º –≤–≤–µ—Å—Ç–∏ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å bot.send_message(message.chat.id, "–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å.") bot.register_next_step_handler(message, get_new_password, name) else: bot.send_message(message.chat.id, "–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –Ω–∞—à–∏–º –∑–∞–ø–∏—Å–∞–Ω–Ω—ã–º. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.") bot.register_next_step_handler(message, verify_phone_for_reset, name) except Exception as e: bot.send_message(message.chat.id, f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞: {e}") # –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–æ–ª—è def get_new_password(message, name): new_password = message.text.strip() if len(new_password) < 6: bot.send_message(message.chat.id, "–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 6 —Å–∏–º–≤–æ–ª–æ–≤. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.") return bot.register_next_step_handler(message, get_new_password, name) # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö try: cursor.execute("UPDATE students SET password = %s WHERE name = %s", (new_password, name)) conn.commit() bot.send_message(message.chat.id, "–í–∞—à –ø–∞—Ä–æ–ª—å –±—ã–ª —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!") except Exception as e: bot.send_message(message.chat.id, f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–∞—Ä–æ–ª—è: {e}") # –ö–æ–º–∞–Ω–¥–∞ /clear @bot.message_handler(commands=['clear']) def handle_clear_chat(message): clear_chat(message) # –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å @bot.message_handler(commands=['adminpanel']) def admin_panel(message): if len(message.text.split()) == 2 and message.text.split()[1] == '123456789':
cursor.execute("SELECT * FROM admins WHERE telegram_id = %s", (message.chat.id,)) admin = cursor.fetchone() if admin: bot.send_message(message.chat.id, "‚úÖ –í—ã –≤–æ—à–ª–∏ –≤ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å! –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:", reply_markup=admin_menu()) else: bot.send_message(message.chat.id, "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.") else: bot.send_message(message.chat.id, "‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å.") def admin_menu(): markup = telebot.types.ReplyKeyboardMarkup(resize_keyboard=True) view_orders_button = telebot.types.KeyboardButton("üì¶ –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–∫–∞–∑—ã") manage_feedback_button = telebot.types.KeyboardButton("üí¨ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–∑—ã–≤–∞–º–∏") manage_admins_button = telebot.types.KeyboardButton("üë§ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞–º–∏") update_order_status_button = telebot.types.KeyboardButton("üîÑ –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞") send_message_to_client_button = telebot.types.KeyboardButton("‚úâÔ∏è –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É") view_students_button = telebot.types.KeyboardButton("üéì –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–æ–≤") accounting_button = telebot.types.KeyboardButton("üí∞ –ë—É—Ö–≥–∞–ª—Ç–µ—Ä") back_button_admin = telebot.types.KeyboardButton("–ù–∞–∑–∞–¥") markup.add(view_orders_button, manage_feedback_button, manage_admins_button, update_order_status_button, send_message_to_client_button, view_students_button, accounting_button, back_button_admin) return markup @bot.message_handler(func=lambda message: message.text == "üí∞ –ë—É—Ö–≥–∞–ª—Ç–µ—Ä") def accounting(message): cursor.execute("SELECT SUM(price) FROM orders") total_sum = cursor.fetchone()[0] if total_sum is not None: bot.send_message(message.chat.id, f"üí∞ –û–±—â–∞—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–æ–≤: {total_sum} —Ç–µ–Ω–≥–µ.") else: bot.send_message(message.chat.id, "‚ùå –ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤ –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞.") @bot.message_handler(func=lambda message: message.text == "üì¶ –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–∫–∞–∑—ã") def view_orders(message): markup = telebot.types.ReplyKeyboardMarkup(resize_keyboard=True) all_orders_button = telebot.types.KeyboardButton("üìã –í—Å–µ –∑–∞–∫–∞–∑—ã") in_progress_orders_button = telebot.types.KeyboardButton("‚è≥ –ó–∞–∫–∞–∑—ã –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ") closed_orders_button = telebot.types.KeyboardButton("‚úÖ –ó–∞–∫—Ä—ã—Ç—ã–µ –∑–∞–∫–∞–∑—ã") delete_orders_button = telebot.types.KeyboardButton("üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –∑–∞–∫–∞–∑—ã")
clear_orders_button = telebot.types.KeyboardButton("üßπ –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –∑–∞–∫–∞–∑—ã") back_button_admin = telebot.types.KeyboardButton("–ù–∞–∑–∞–¥") markup.add(all_orders_button, in_progress_orders_button, closed_orders_button, delete_orders_button, clear_orders_button, back_button_admin) bot.send_message(message.chat.id, "üì¶ –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:", reply_markup=markup) @bot.message_handler(func=lambda message: message.text == "üìã –í—Å–µ –∑–∞–∫–∞–∑—ã") def all_orders(message): cursor.execute("SELECT * FROM orders") orders = cursor.fetchall() if orders: orders_message = "üì¶ –í—Å–µ –∑–∞–∫–∞–∑—ã:\n" for order in orders: orders_message += f"ID: {order[0]}, –°—Ç—É–¥–µ–Ω—Ç ID: {order[1]}, –î–µ—Ç–∞–ª–∏: {order[2]}, –°—Ç–∞—Ç—É—Å: {order[4]}\n" bot.send_message(message.chat.id, orders_message) else: bot.send_message(message.chat.id, "‚ùå –ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.") @bot.message_handler(func=lambda message: message.text == "‚è≥ –ó–∞–∫–∞–∑—ã –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ") def in_progress_orders(message): cursor.execute("SELECT * FROM orders WHERE status = '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ'") orders = cursor.fetchall() if orders: orders_message = "‚è≥ –ó–∞–∫–∞–∑—ã –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ:\n" for order in orders: orders_message += f"ID: {order[0]}, –°—Ç—É–¥–µ–Ω—Ç ID: {order[1]}, –î–µ—Ç–∞–ª–∏: {order[2]}, –°—Ç–∞—Ç—É—Å: {order[4]}\n" bot.send_message(message.chat.id, orders_message) else: bot.send_message(message.chat.id, "‚ùå –ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤ –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ.") @bot.message_handler(func=lambda message: message.text == "‚úÖ –ó–∞–∫—Ä—ã—Ç—ã–µ –∑–∞–∫–∞–∑—ã") def closed_orders(message): cursor.execute("SELECT * FROM orders WHERE status = '–ó–∞–∫—Ä—ã—Ç–æ'") orders = cursor.fetchall() if orders: orders_message = "‚úÖ –ó–∞–∫—Ä—ã—Ç—ã–µ –∑–∞–∫–∞–∑—ã:\n" for order in orders: orders_message += f"ID: {order[0]}, –°—Ç—É–¥–µ–Ω—Ç ID: {order[1]}, –î–µ—Ç–∞–ª–∏: {order[2]}, –°—Ç–∞—Ç—É—Å: {order[4]}\n" bot.send_message(message.chat.id, orders_message) else: bot.send_message(message.chat.id, "‚ùå –ù–µ—Ç –∑–∞–∫—Ä—ã—Ç—ã—Ö –∑–∞–∫–∞–∑–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.") @bot.message_handler(func=lambda message: message.text == "üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –∑–∞–∫–∞–∑—ã") def delete_orders(message):
bot.send_message(message.chat.id, "–í–≤–µ–¥–∏—Ç–µ ID –∑–∞–∫–∞–∑–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è:") bot.register_next_step_handler(message, remove_order) def remove_order(message): order_id = message.text.strip() try: cursor.execute("DELETE FROM orders WHERE id = %s", (order_id,)) conn.commit() bot.send_message(message.chat.id, "‚úÖ –ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª—ë–Ω.") except Exception as e: conn.rollback() bot.send_message(message.chat.id, f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞: {e}") @bot.message_handler(func=lambda message: message.text == "üßπ –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –∑–∞–∫–∞–∑—ã") def clear_orders(message): try: cursor.execute("DELETE FROM orders") conn.commit() bot.send_message(message.chat.id, "‚úÖ –í—Å–µ –∑–∞–∫–∞–∑—ã —É—Å–ø–µ—à–Ω–æ –æ—á–∏—â–µ–Ω—ã.") except Exception as e: conn.rollback() bot.send_message(message.chat.id, f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –∑–∞–∫–∞–∑–æ–≤: {e}") @bot.message_handler(func=lambda message: message.text == "üîÑ –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞") def update_order_status(message): try: query = """ SELECT orders.id, students.name, orders.order_details, orders.status FROM orders JOIN students ON orders.student_id = students.id """ cursor.execute(query) orders = cursor.fetchall() if not orders: bot.send_message(message.chat.id, "‚ùå –ó–∞–∫–∞–∑—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.") return markup = telebot.types.ReplyKeyboardMarkup(one_time_keyboard=True, resize_keyboard=True) for order in orders: markup.add(f"ID –∑–∞–∫–∞–∑–∞: {order[0]}, –ò–º—è –∫–ª–∏–µ–Ω—Ç–∞: {order[1]}, –î–µ—Ç–∞–ª–∏: {order[2]}, –°—Ç–∞—Ç—É—Å: {order[3]}\n") markup.add("üîô –ù–∞–∑–∞–¥") bot.send_message(message.chat.id, "–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–∫–∞–∑ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞:", reply_markup=markup) bot.register_next_step_handler(message, change_order_status) except Exception as e:
bot.send_message(message.chat.id, f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∑–∞–∫–∞–∑–æ–≤: {e}") print(f"[–û—à–∏–±–∫–∞] {e}") def change_order_status(message): if message.text == "–ù–∞–∑–∞–¥": # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤ –º–µ–Ω—é –∞–¥–º–∏–Ω–∞ admin_menu(message) return try: order_id = message.text.split(",")[0].split(":")[1].strip() markup = telebot.types.ReplyKeyboardMarkup(one_time_keyboard=True, resize_keyboard=True) markup.add("–ì–æ—Ç–æ–≤–∞", "–í –ø—Ä–æ—Ü–µ—Å—Å–µ", "–ó–∞–∫—Ä—ã—Ç–æ", "‚úçÔ∏è –í–≤–µ—Å—Ç–∏ —Å—Ç–∞—Ç—É—Å –≤—Ä—É—á–Ω—É—é", "–ù–∞–∑–∞–¥") bot.send_message(message.chat.id, "–í—ã–±–µ—Ä–∏—Ç–µ –Ω–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –≤—Ä—É—á–Ω—É—é:", reply_markup=markup) bot.register_next_step_handler(message, save_order_status, order_id) # –ü–µ—Ä–µ–¥–∞–µ–º order_id except Exception as e: bot.send_message(message.chat.id, f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –∑–∞–∫–∞–∑–∞: {e}") print(f"[–û—à–∏–±–∫–∞] {e}") def save_order_status(message, order_id): if message.text == "–ù–∞–∑–∞–¥": update_order_status(message) return new_status = message.text.strip() if new_status == "‚úçÔ∏è –í–≤–µ—Å—Ç–∏ —Å—Ç–∞—Ç—É—Å –≤—Ä—É—á–Ω—É—é": bot.send_message(message.chat.id, "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞:") bot.register_next_step_handler(message, save_order_status_manual, order_id) else: try: cursor.execute("UPDATE orders SET status = %s WHERE id = %s", (new_status, order_id)) conn.commit() bot.send_message(message.chat.id, "‚úÖ –°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω—ë–Ω.") # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É cursor.execute("SELECT student_id, order_details FROM orders WHERE id = %s", (order_id,)) order_info = cursor.fetchone() if not order_info: bot.send_message(message.chat.id, "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–∫–∞–∑–µ.") return student_id = order_info[0]
order_details = order_info[1] cursor.execute("SELECT chat_id FROM students WHERE id = %s", (student_id,)) client_chat_id = cursor.fetchone() if not client_chat_id: bot.send_message(message.chat.id, "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —á–∞—Ç –∫–ª–∏–µ–Ω—Ç–∞.") return bot.send_message(client_chat_id[0], f"üì¢ –í–∞—à —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ —Å ID {order_id} –±—ã–ª –∏–∑–º–µ–Ω—ë–Ω –Ω–∞: {new_status}. –î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞: {order_details}.") except Exception as e: conn.rollback() bot.send_message(message.chat.id, f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞: {e}") print(f"[–û—à–∏–±–∫–∞] {e}") def save_order_status_manual(message, order_id): if message.text == "–ù–∞–∑–∞–¥": update_order_status(message) return new_status = message.text.strip() try: cursor.execute("UPDATE orders SET status = %s WHERE id = %s", (new_status, order_id)) conn.commit() bot.send_message(message.chat.id, "‚úÖ –°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω—ë–Ω.") # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É cursor.execute("SELECT student_id, order_details FROM orders WHERE id = %s", (order_id,)) order_info = cursor.fetchone() if not order_info: bot.send_message(message.chat.id, "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–∫–∞–∑–µ.") return student_id = order_info[0] order_details = order_info[1] cursor.execute("SELECT chat_id FROM students WHERE id = %s", (student_id,)) client_chat_id = cursor.fetchone() if not client_chat_id: bot.send_message(message.chat.id, "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —á–∞—Ç –∫–ª–∏–µ–Ω—Ç–∞.") return
bot.send_message(client_chat_id[0], f"üì¢ –í–∞—à —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ —Å ID {order_id} –±—ã–ª –∏–∑–º–µ–Ω—ë–Ω –Ω–∞: {new_status}. –î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞: {order_details}.") except Exception as e: conn.rollback() bot.send_message(message.chat.id, f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞: {e}") print(f"[–û—à–∏–±–∫–∞] {e}") @bot.message_handler(func=lambda message: message.text == "‚úâÔ∏è –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É") def send_message_to_client(message): cursor.execute("SELECT id, name FROM students") students = cursor.fetchall() markup = telebot.types.ReplyKeyboardMarkup(resize_keyboard=True) for student in students: student_button = telebot.types.KeyboardButton(f"{student[1]} (ID: {student[0]})") markup.add(student_button) back_button_admin = telebot.types.KeyboardButton("–ù–∞–∑–∞–¥") markup.add(back_button_admin) bot.send_message(message.chat.id, "–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—É–¥–µ–Ω—Ç–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:", reply_markup=markup) @bot.message_handler(func=lambda message: message.text.endswith(")")) def get_client_id(message): student_id = message.text.split(" (ID: ")[1][:-1] bot.send_message(message.chat.id, "–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞:") bot.register_next_step_handler(message, send_message, student_id) def send_message(message, student_id): client_message = message.text.strip() try: cursor.execute("SELECT chat_id FROM students WHERE id = %s", (student_id,)) client_chat_id = cursor.fetchone()[0] bot.send_message(client_chat_id, client_message) bot.send_message(message.chat.id, "‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∫–ª–∏–µ–Ω—Ç—É.") except Exception as e: bot.send_message(message.chat.id, f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è: {e}") @bot.message_handler(func=lambda message: message.text == "üí¨ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–∑—ã–≤–∞–º–∏") def manage_feedback(message): markup = telebot.types.ReplyKeyboardMarkup(resize_keyboard=True) show_feedback_button = telebot.types.KeyboardButton("üëÅÔ∏è –ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–∑—ã–≤—ã") delete_feedback_button = telebot.types.KeyboardButton("üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –æ—Ç–∑—ã–≤") back_button_admin = telebot.types.KeyboardButton("–ù–∞–∑–∞–¥") markup.add(show_feedback_button, delete_feedback_button, back_button_admin)
bot.send_message(message.chat.id, "üìã –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:", reply_markup=markup) @bot.message_handler(func=lambda message: message.text == "üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –æ—Ç–∑—ã–≤") def delete_feedback(message): bot.send_message(message.chat.id, "–í–≤–µ–¥–∏—Ç–µ ID –æ—Ç–∑—ã–≤–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è:") bot.register_next_step_handler(message, remove_feedback) def remove_feedback(message): feedback_id = message.text.strip() try: cursor.execute("DELETE FROM feedback WHERE id = %s", (feedback_id,)) conn.commit() bot.send_message(message.chat.id, "‚úÖ –û—Ç–∑—ã–≤ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª—ë–Ω.") except Exception as e: conn.rollback() bot.send_message(message.chat.id, f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –æ—Ç–∑—ã–≤–∞: {e}") @bot.message_handler(func=lambda message: message.text == "üë§ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞–º–∏") def manage_admins(message): markup = telebot.types.ReplyKeyboardMarkup(resize_keyboard=True) add_admin_button = telebot.types.KeyboardButton("‚ûï –î–æ–±–∞–≤–∏—Ç—å –∞–¥–º–∏–Ω–∞") remove_admin_button = telebot.types.KeyboardButton("‚ûñ –£–¥–∞–ª–∏—Ç—å –∞–¥–º–∏–Ω–∞") back_button_admin = telebot.types.KeyboardButton("–ù–∞–∑–∞–¥") markup.add(add_admin_button, remove_admin_button, back_button_admin) bot.send_message(message.chat.id, "üë• –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:", reply_markup=markup) @bot.message_handler(func=lambda message: message.text == "‚ûï –î–æ–±–∞–≤–∏—Ç—å –∞–¥–º–∏–Ω–∞") def add_admin(message): bot.send_message(message.chat.id, "–í–≤–µ–¥–∏—Ç–µ Telegram ID –Ω–æ–≤–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:") bot.register_next_step_handler(message, save_new_admin) def save_new_admin(message): telegram_id = message.text.strip() try: cursor.execute("INSERT INTO admins (telegram_id) VALUES (%s)", (telegram_id,)) conn.commit() bot.send_message(message.chat.id, "‚úÖ –ê–¥–º–∏–Ω —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω.") except psycopg2.IntegrityError: conn.rollback() bot.send_message(message.chat.id, "‚ùå –≠—Ç–æ—Ç –∞–¥–º–∏–Ω —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.") except Exception as e: conn.rollback() bot.send_message(message.chat.id, f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∞–¥–º–∏–Ω–∞: {e}") @bot.message_handler(func=lambda message: message.text == "‚ûñ –£–¥–∞–ª–∏—Ç—å –∞–¥–º–∏–Ω–∞")
def remove_admin(message): bot.send_message(message.chat.id, "–í–≤–µ–¥–∏—Ç–µ Telegram ID –∞–¥–º–∏–Ω–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è:") bot.register_next_step_handler(message, delete_admin) def delete_admin(message): telegram_id = message.text.strip() try: cursor.execute("DELETE FROM admins WHERE telegram_id = %s", (telegram_id,)) conn.commit() bot.send_message(message.chat.id, "‚úÖ –ê–¥–º–∏–Ω —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª—ë–Ω.") except Exception as e: conn.rollback() bot.send_message(message.chat.id, f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞: {e}") @bot.message_handler(func=lambda message: message.text == "üéì –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–æ–≤") def view_students(message): cursor.execute("SELECT * FROM students") students = cursor.fetchall() if students: students_message = "üéì –í—Å–µ —Å—Ç—É–¥–µ–Ω—Ç—ã:\n\n" for student in students: students_message += ( f"ID: {student[0]}\n" f"–ò–º—è: {student[1]}\n" f"–ù–æ–º–µ—Ä: {student[2]}\n" f"–ü–∞—Ä–æ–ª—å: {student[3]}\n" f"–ß–∞—Ç ID: {student[4]}\n" "------------------------\n" ) bot.send_message(message.chat.id, students_message) else: bot.send_message(message.chat.id, "‚ùå –ù–µ—Ç —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.") @bot.message_handler(func=lambda message: message.text == "–ù–∞–∑–∞–¥") def back_button_admin(message): bot.send_message(message.chat.id, "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:", reply_markup=admin_menu()) # –ö–æ—Ä–∑–∏–Ω–∞ @bot.message_handler(func=lambda message: message.text == "üõí –ö–æ—Ä–∑–∏–Ω–∞") def view_cart(message): student_id = get_student_id(message.chat.id) if student_id in cart and cart[student_id]: cart_items = "\n".join(f"{i+1}. {item['name']} x{item['quantity']} - {calculate_item_price(item['name']) * item['quantity']} ‚Ç∏" for i, item in enumerate(cart[student_id])) total_price = calculate_total_price(cart[student_id]) markup = telebot.types.ReplyKeyboardMarkup(resize_keyboard=True)
clear_cart_button = telebot.types.KeyboardButton("üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É") checkout_button = telebot.types.KeyboardButton("‚úÖ –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑") back_button = telebot.types.KeyboardButton("üîô –ù–∞–∑–∞–¥") markup.add(clear_cart_button, checkout_button, back_button) bot.send_message(message.chat.id, f"üõçÔ∏è –í–∞—à–∏ —Ç–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω–µ:\n{cart_items}\n\nüí∞ –û–±—â–∞—è —Å—É–º–º–∞: {total_price} ‚Ç∏", reply_markup=markup) else: bot.send_message(message.chat.id, "üõí –í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞.") # –û—á–∏—Å—Ç–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã @bot.message_handler(func=lambda message: message.text == "üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É") def clear_cart(message): student_id = get_student_id(message.chat.id) if student_id in cart: del cart[student_id] bot.send_message(message.chat.id, "üóëÔ∏è –í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –æ—á–∏—â–µ–Ω–∞.") else: bot.send_message(message.chat.id, "üõí –í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞.") @bot.message_handler(func=lambda message: message.text == "‚úÖ –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑") def checkout(message): student_id = get_student_id(message.chat.id) if student_id in cart and cart[student_id]: order_details = ", ".join(f"{item['name']} x{item['quantity']}" for item in cart[student_id]) estimated_delivery_time = "15 –º–∏–Ω—É—Ç" total_price = calculate_total_price(cart[student_id]) cursor.execute("SELECT name FROM students WHERE id = %s", (student_id,)) student_name = cursor.fetchone() if not student_name: bot.send_message(message.chat.id, "‚ùå –û—à–∏–±–∫–∞: –∏–º—è —Å—Ç—É–¥–µ–Ω—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.") return student_name = student_name[0] try: cursor.execute( "INSERT INTO orders (student_id, order_details, estimated_delivery_time, status, name, price) VALUES (%s, %s, %s, %s, %s,%s)", (student_id, order_details, estimated_delivery_time, "–í –æ–±—Ä–∞–±–æ—Ç–∫–µ", student_name, total_price) ) conn.commit() bot.send_message(message.chat.id, f"‚úÖ –í–∞—à –∑–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω! –û–∂–∏–¥–∞–π—Ç–µ, –ø—Ä–∏–º–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è —Å–∞–º–æ–≤—ã–≤–æ–∑–∞: {estimated_delivery_time}\n\nüõçÔ∏è –ó–∞–∫–∞–∑–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã:\n{order_details}\nüí∞ –û–±—â–∞—è —Å—É–º–º–∞: {total_price} ‚Ç∏") del cart[student_id] except Exception as e:
conn.rollback() bot.send_message(message.chat.id, f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞: {e}") else: bot.send_message(message.chat.id, "üõí –í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞.") def calculate_item_price(item_name): prices = { "‚òï –≠—Å–ø—Ä–µ—Å—Å–æ": 600, "‚òï –ö–∞–ø—É—á–∏–Ω–æ": 1000, "‚òï –õ–∞—Ç—Ç–µ": 1200, "‚òï –ê–º–µ—Ä–∏–∫–∞–Ω–æ": 800, "‚òï –ú–æ–∫–∫–æ": 1100, "üçπ –§—Ä–∞–ø–ø–µ": 1300, "üçÉ –ó–µ–ª—ë–Ω—ã–π —á–∞–π": 600, "üçÇ –ß—ë—Ä–Ω—ã–π —á–∞–π —Å –±–µ—Ä–≥–∞–º–æ—Ç–æ–º": 700, "üåø –ò–≤–∞–Ω-—á–∞–π": 900, "üçã –ß–∞–π —Å –ª–∏–º–æ–Ω–æ–º": 800, "üßπ –ë–∞—É—ã—Ä—Å–∞–∫–∏": 700, "üßπ –°–∞–º—Å–∞ —Å –º—è—Å–æ–º": 800, "üçØ –ß–∞–∫-—á–∞–∫": 1000, "üßπ –ü–∏—Ä–æ–∂–∫–∏ —Å –∫–∞—Ä—Ç–æ—à–∫–æ–π": 900 } return prices.get(item_name, 0) def calculate_total_price(cart_items): return sum(calculate_item_price(item['name']) * item['quantity'] for item in cart_items) # –ö–Ω–æ–ø–∫–∞ –ù–∞–∑–∞–¥ @bot.message_handler(func=lambda message: message.text == "üîô –ù–∞–∑–∞–¥") def back_button(message): show_menu(message.chat.id) # –ö–æ–Ω—Ç–∞–∫—Ç—ã @bot.message_handler(func=lambda message: message.text == "üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã") def send_contacts(message): contacts_info = ( "üìû –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞: 87073804075\n" "üåê –°–∞–π—Ç: [mokkocoffeeshop](http://mokkocoffeeshop)\n" "‚úâÔ∏è –ü–æ—á—Ç–∞: mokkocoffeeshop@gmail.com\n" "üè¢ –ê–¥—Ä–µ—Å: —É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, 123" ) bot.send_message(message.chat.id, contacts_info, parse_mode='Markdown') # –û—Ç–∑—ã–≤—ã @bot.message_handler(func=lambda message: message.text == "üí¨ –û—Ç–∑—ã–≤—ã") def send_feedback(message): markup = telebot.types.ReplyKeyboardMarkup(resize_keyboard=True) show_feedback_button = telebot.types.KeyboardButton("üëÅÔ∏è –ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–∑—ã–≤—ã") write_feedback_button = telebot.types.KeyboardButton("‚úçÔ∏è –ù–∞–ø–∏—Å–∞—Ç—å –æ—Ç–∑—ã–≤")
back_button = telebot.types.KeyboardButton("üîô –ù–∞–∑–∞–¥") markup.add(show_feedback_button, write_feedback_button, back_button) bot.send_message(message.chat.id, "üìã –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:", reply_markup=markup) @bot.message_handler(func=lambda message: message.text == "üëÅÔ∏è –ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–∑—ã–≤—ã") def show_feedback(message): cursor.execute("SELECT feedback_text FROM feedback") feedbacks = cursor.fetchall() if feedbacks: feedback_message = "üí¨ –û—Ç–∑—ã–≤—ã:\n" for feedback in feedbacks: feedback_message += f"- {feedback[0]}\n" bot.send_message(message.chat.id, feedback_message) else: bot.send_message(message.chat.id, "‚ùå –ù–µ—Ç –æ—Ç–∑—ã–≤–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.") @bot.message_handler(func=lambda message: message.text == "‚úçÔ∏è –ù–∞–ø–∏—Å–∞—Ç—å –æ—Ç–∑—ã–≤") def request_feedback(message): bot.send_message(message.chat.id, "üí¨ –û—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à –æ—Ç–∑—ã–≤:") bot.register_next_step_handler(message, save_feedback) def save_feedback(message): feedback_text = message.text.strip() student_name = get_student_name(message.chat.id) try: cursor.execute( "INSERT INTO feedback (student_name, feedback_text) VALUES (%s, %s)", (student_name, feedback_text) ) conn.commit() bot.send_message(message.chat.id, "‚úÖ –í–∞—à –æ—Ç–∑—ã–≤ –ø—Ä–∏–Ω—è—Ç! –°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à–µ –º–Ω–µ–Ω–∏–µ.") except Exception as e: conn.rollback() bot.send_message(message.chat.id, f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –æ—Ç–∑—ã–≤–∞: {e}") # –í—Ö–æ–¥ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞ @bot.message_handler(func=lambda message: message.text == "üë§ –í–æ–π—Ç–∏") def login_student(message): bot.send_message(message.chat.id, "–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è.") bot.register_next_step_handler(message, login_password) def login_password(message): name = message.text.strip() bot.send_message(message.chat.id, "–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –ø–∞—Ä–æ–ª—å.") bot.register_next_step_handler(message, verify_login, name) def verify_login(message, name): password = message.text.strip()
cursor.execute("SELECT * FROM students WHERE name = %s AND password = %s", (name, password)) student = cursor.fetchone() if student: bot.send_message(message.chat.id, "‚úÖ –í—ã —É—Å–ø–µ—à–Ω–æ –≤–æ—à–ª–∏ –≤ —Å–∏—Å—Ç–µ–º—É!") show_menu(message.chat.id) else: bot.send_message(message.chat.id, "‚ùå –ù–µ–≤–µ—Ä–Ω–æ–µ –∏–º—è –∏–ª–∏ –ø–∞—Ä–æ–ª—å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.") send_welcome(message) # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞ @bot.message_handler(func=lambda message: message.text == "üìù –ù–∞—á–∞—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é") def register_student(message): bot.send_message(message.chat.id, "–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è.") bot.register_next_step_handler(message, register_phone) def register_phone(message): name = message.text.strip() if not name: bot.send_message(message.chat.id, "‚ùå –ò–º—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.") return bot.register_next_step_handler(message, register_phone) bot.send_message(message.chat.id, "–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ +77471630809 –∏–ª–∏ 77471630809.") bot.register_next_step_handler(message, register_password, name) def register_password(message, name): phone = message.text.strip() if not (phone.startswith('+') and phone[1:].isdigit()) and not phone.isdigit(): bot.send_message(message.chat.id, "‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ.") return bot.register_next_step_handler(message, register_password, name) bot.send_message(message.chat.id, "–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –ø–∞—Ä–æ–ª—å –¥–ª—è –∑–∞—â–∏—Ç—ã –∞–∫–∫–∞—É–Ω—Ç–∞.") bot.register_next_step_handler(message, save_student, name, phone) def save_student(message, name, phone): password = message.text.strip() if len(password) < 6: bot.send_message(message.chat.id, "‚ùå –ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 6 —Å–∏–º–≤–æ–ª–æ–≤. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.") return bot.register_next_step_handler(message, save_student, name, phone) try: cursor.execute( "INSERT INTO students (name, phone, password, chat_id) VALUES (%s, %s, %s, %s)", (name, phone, password, message.chat.id) ) conn.commit()
bot.send_message(message.chat.id, "‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å.") show_menu(message.chat.id) except psycopg2.IntegrityError: conn.rollback() bot.send_message(message.chat.id, "‚ùå –≠—Ç–æ—Ç –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω.") except Exception as e: conn.rollback() bot.send_message(message.chat.id, f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: {e}") # –ü–æ–∫–∞–∑ –º–µ–Ω—é def show_menu(chat_id): markup = telebot.types.ReplyKeyboardMarkup(resize_keyboard=True) coffee_button = telebot.types.KeyboardButton("‚òï –ö–æ—Ñ–µ") tea_button = telebot.types.KeyboardButton("üçµ –ß–∞–π") snacks_button = telebot.types.KeyboardButton("üç¥ –ó–∞–∫—É—Å–∫–∏") order_status_button = telebot.types.KeyboardButton("üì¶ –°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞") contacts_button = telebot.types.KeyboardButton("üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã") feedback_button = telebot.types.KeyboardButton("üí¨ –û—Ç–∑—ã–≤—ã") cart_button = telebot.types.KeyboardButton("üõí –ö–æ—Ä–∑–∏–Ω–∞") markup.add(coffee_button, tea_button, snacks_button, order_status_button, contacts_button, feedback_button, cart_button) bot.send_message(chat_id, "üìã –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é:", reply_markup=markup) # –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ @bot.message_handler(func=lambda message: message.text in ["‚òï –ö–æ—Ñ–µ", "üçµ –ß–∞–π", "üç¥ –ó–∞–∫—É—Å–∫–∏"]) def handle_category_selection(message): if message.text == "‚òï –ö–æ—Ñ–µ": show_coffee_menu(message.chat.id) elif message.text == "üçµ –ß–∞–π": show_tea_menu(message.chat.id) elif message.text == "üç¥ –ó–∞–∫—É—Å–∫–∏": show_snacks_menu(message.chat.id) # –ü–æ–∫–∞–∑ –º–µ–Ω—é –∫–æ—Ñ–µ def show_coffee_menu(chat_id): coffee_menu = ( "‚òï –ú–µ–Ω—é –ö–æ—Ñ–µ\n\n" "1. ‚òï –≠—Å–ø—Ä–µ—Å—Å–æ - 600 ‚Ç∏\n" "2. ‚òï –ö–∞–ø—É—á–∏–Ω–æ - 1000 ‚Ç∏\n" "3. ‚òï –õ–∞—Ç—Ç–µ - 1200 ‚Ç∏\n" "4. ‚òï –ê–º–µ—Ä–∏–∫–∞–Ω–æ - 800 ‚Ç∏\n" "5. ‚òï –ú–æ–∫–∫–æ - 1100 ‚Ç∏\n" "6. üçπ –§—Ä–∞–ø–ø–µ - 1300 ‚Ç∏\n" "7. üîô –ù–∞–∑–∞–¥" ) markup = telebot.types.ReplyKeyboardMarkup(resize_keyboard=True) for item in ["‚òï –≠—Å–ø—Ä–µ—Å—Å–æ", "‚òï –ö–∞–ø—É—á–∏–Ω–æ", "‚òï –õ–∞—Ç—Ç–µ", "‚òï –ê–º–µ—Ä–∏–∫–∞–Ω–æ", "‚òï –ú–æ–∫–∫–æ", "üçπ –§—Ä–∞–ø–ø–µ", "üîô –ù–∞–∑–∞–¥"]:
markup.add(telebot.types.KeyboardButton(item)) bot.send_message(chat_id, coffee_menu, reply_markup=markup) # –ü–æ–∫–∞–∑ –º–µ–Ω—é —á–∞—è def show_tea_menu(chat_id): tea_menu = ( "üçµ –ú–µ–Ω—é –ß–∞—è\n" "1. üçÉ –ó–µ–ª—ë–Ω—ã–π —á–∞–π - 600 ‚Ç∏\n" "2. üçÇ –ß—ë—Ä–Ω—ã–π —á–∞–π —Å –±–µ—Ä–≥–∞–º–æ—Ç–æ–º - 700 ‚Ç∏\n" "3. üåø –ò–≤–∞–Ω-—á–∞–π - 900 ‚Ç∏\n" "4. üçã –ß–∞–π —Å –ª–∏–º–æ–Ω–æ–º - 800 ‚Ç∏\n" "5. üîô –ù–∞–∑–∞–¥" ) markup = telebot.types.ReplyKeyboardMarkup(resize_keyboard=True) for item in ["üçÉ –ó–µ–ª—ë–Ω—ã–π —á–∞–π", "üçÇ –ß—ë—Ä–Ω—ã–π —á–∞–π —Å –±–µ—Ä–≥–∞–º–æ—Ç–æ–º", "üåø –ò–≤–∞–Ω-—á–∞–π", "üçã –ß–∞–π —Å –ª–∏–º–æ–Ω–æ–º", "üîô –ù–∞–∑–∞–¥"]: markup.add(telebot.types.KeyboardButton(item)) bot.send_message(chat_id, tea_menu, reply_markup=markup) # –ü–æ–∫–∞–∑ –º–µ–Ω—é –∑–∞–∫—É—Å–æ–∫ def show_snacks_menu(chat_id): snacks_menu = ( "üç¥ –ú–µ–Ω—é –ó–∞–∫—É—Å–æ–∫\n" "1. üßπ –ë–∞—É—ã—Ä—Å–∞–∫–∏ - 700 ‚Ç∏\n" "2. üßπ –°–∞–º—Å–∞ —Å –º—è—Å–æ–º - 800 ‚Ç∏\n" "3. üçØ –ß–∞–∫-—á–∞–∫ - 1000 ‚Ç∏\n" "4. üßπ –ü–∏—Ä–æ–∂–∫–∏ —Å –∫–∞—Ä—Ç–æ—à–∫–æ–π - 900 ‚Ç∏\n" "5. üîô –ù–∞–∑–∞–¥" ) markup = telebot.types.ReplyKeyboardMarkup(resize_keyboard=True) for item in ["üßπ –ë–∞—É—ã—Ä—Å–∞–∫–∏", "üßπ –°–∞–º—Å–∞ —Å –º—è—Å–æ–º", "üçØ –ß–∞–∫-—á–∞–∫", "üßπ –ü–∏—Ä–æ–∂–∫–∏ —Å –∫–∞—Ä—Ç–æ—à–∫–æ–π", "üîô –ù–∞–∑–∞–¥"]: markup.add(telebot.types.KeyboardButton(item)) bot.send_message(chat_id, snacks_menu, reply_markup=markup) # –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ç–æ–≤–∞—Ä–∞ @bot.message_handler(func=lambda message: message.text in ["‚òï –≠—Å–ø—Ä–µ—Å—Å–æ", "‚òï –ö–∞–ø—É—á–∏–Ω–æ", "‚òï –õ–∞—Ç—Ç–µ", "‚òï –ê–º–µ—Ä–∏–∫–∞–Ω–æ", "‚òï –ú–æ–∫–∫–æ", "üçπ –§—Ä–∞–ø–ø–µ","üçÉ –ó–µ–ª—ë–Ω—ã–π —á–∞–π", "üçÇ –ß—ë—Ä–Ω—ã–π —á–∞–π —Å –±–µ—Ä–≥–∞–º–æ—Ç–æ–º", "üåø –ò–≤–∞–Ω-—á–∞–π", "üçã –ß–∞–π —Å –ª–∏–º–æ–Ω–æ–º","üßπ –ë–∞—É—ã—Ä—Å–∞–∫–∏", "üßπ –°–∞–º—Å–∞ —Å –º—è—Å–æ–º", "üçØ –ß–∞–∫-—á–∞–∫", "üßπ –ü–∏—Ä–æ–∂–∫–∏ —Å –∫–∞—Ä—Ç–æ—à–∫–æ–π", "üîô –ù–∞–∑–∞–¥"]) def handle_order_selection(message): if message.text == "üîô –ù–∞–∑–∞–¥": show_menu(message.chat.id) else: order_details = message.text bot.send_message(message.chat.id, "–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ:") bot.register_next_step_handler(message, add_to_cart, order_details) def add_to_cart(message, order_details): if message.text == "üîô –ù–∞–∑–∞–¥":
show_menu(message.chat.id) return quantity = int(message.text.strip()) student_id = get_student_id(message.chat.id) if student_id not in cart: cart[student_id] = [] cart[student_id].append({"name": order_details, "quantity": quantity}) bot.send_message(message.chat.id, f"‚úÖ {order_details} x{quantity} –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É. –í—ã–±–µ—Ä–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π —Ç–æ–≤–∞—Ä –∏–ª–∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –∫–æ—Ä–∑–∏–Ω—É.") def get_student_id(chat_id): cursor.execute("SELECT id FROM students WHERE chat_id = %s", (chat_id,)) student = cursor.fetchone() return student[0] if student else None def get_student_name(chat_id): cursor.execute("SELECT name FROM students WHERE chat_id = %s", (chat_id,)) student = cursor.fetchone() return student[0] if student else None # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞ @bot.message_handler(func=lambda message: message.text == "üì¶ –°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞") def check_order_status(message): student_id = get_student_id(message.chat.id) cursor.execute("SELECT order_details, status FROM orders WHERE student_id = %s", (student_id,)) orders = cursor.fetchall() if orders: status_message = "üì¶ –í–∞—à–∏ –∑–∞–∫–∞–∑—ã:\n" for order in orders: status_message += f"–ó–∞–∫–∞–∑: {order[0]}, –°—Ç–∞—Ç—É—Å: {order[1]}\n" bot.send_message(message.chat.id, status_message) else: bot.send_message(message.chat.id, "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤.") @bot.message_handler(func=lambda message: True) def fallback_response(message): bot.send_message(message.chat.id, "‚ùó –ò–∑–≤–∏–Ω–∏—Ç–µ, —è –Ω–µ –ø–æ–Ω–∏–º–∞—é —ç—Ç—É –∫–æ–º–∞–Ω–¥—É –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏—è. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –∏–ª–∏ –∫–æ–º–∞–Ω–¥—ã –ª–∏–±–æ –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ /help ‚ùó") # –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ try: bot.polling(none_stop=True) except Exception as e: print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞: {e}")
